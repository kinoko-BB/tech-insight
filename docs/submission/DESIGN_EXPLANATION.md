# TechInsight 実装説明・工夫した点

## 1. UI/UXの観点

### 記事詳細のモーダル表示
- 記事一覧画面上でモーダルを開閉する設計を採用
- ページ遷移なしで記事内容を確認でき、一覧への復帰がスムーズ
- 一覧のスクロール位置を維持したまま詳細を閲覧可能

### 検索体験
- セマンティック検索をデフォルトモードに設定し、自然言語での直感的な検索を実現
- キーワード検索へのモード切替UIを提供
- 検索結果に類似度スコアを表示し、検索精度の透明性を確保
- 検索中のローディング表示で即座のフィードバック

### フォーム管理
- react-hook-form + zod による型安全なフォームバリデーション
- クライアントサイドでのリアルタイムバリデーションによりUX向上
- API側のPydanticバリデーションとの二重チェックでデータ品質を保証

### レスポンシブ対応
- Tailwind CSSのブレークポイントを活用したモバイルファースト設計
- デスクトップ・タブレット・モバイルで適切なレイアウト切替

---

## 2. DBの観点

### ベクトル検索基盤
- pgvector拡張を採用し、PostgreSQL内でベクトル検索を完結
- 別途ベクトルDBを立てる必要がなく、Docker Compose構成をシンプルに維持
- HNSWインデックス（m=16, ef_construction=128）でO(log n)の検索時間を実現

### インデックス設計
- **HNSW**: セマンティック検索用（コサイン類似度）
- **GIN + pg_trgm**: title/contentの類似文字列検索用
- **B-tree**: published_at, created_at（ソート用）、category（フィルタ用）
- 1万件規模を見据えた設計。スケールアップ時のパラメータ調整方針も策定済み

### Embeddingモデル選定
- multilingual-e5-small（384次元）を採用
- APIキー不要でローカル完結（評価者の環境再現性を確保）
- CPU環境での1000件処理が現実的な時間で完了する軽量モデル
- Dockerイメージビルド時にモデルを事前キャッシュし、初回起動を高速化

---

## 3. チーム開発を意識した観点

### レイヤー分離アーキテクチャ
```
routers/     → HTTPリクエスト処理（入出力変換）
services/    → ビジネスロジック（テスト容易）
models/      → データアクセス（永続化）
```
- 各レイヤーの責務が明確で、チームメンバー間の分業が容易
- サービス層の独立性により単体テストが書きやすい

### 型安全性の徹底
- **バックエンド**: Pydanticスキーマによるリクエスト/レスポンスの型定義・バリデーション
- **フロントエンド**: TypeScript strict modeによる型安全な開発
- **API仕様**: FastAPIからOpenAPI仕様を自動生成（Single Source of Truth）

### マイグレーション管理
- Alembicによるバージョン管理されたDBマイグレーション
- マイグレーション履歴の追跡が可能で、ロールバックにも対応

### コーディング規約
- Python: PEP 8準拠、型ヒント必須
- TypeScript: strict mode有効
- コミット: Conventional Commits形式

### テスト戦略
- pytestによるバックエンドAPI統合テスト
- CRUD操作・検索API・バリデーション・エラーハンドリングをカバー

---

## 4. 保守運用、スケーラビリティの考慮の観点

### Docker Composeによるワンコマンド起動
```
docker compose up
→ DB起動 → マイグレーション → データ投入 → Embedding生成 → アプリ起動
```
- 評価者が追加設定なしで環境を再現可能
- entrypoint.shで起動フローを一元管理

### 環境設定の外部化
- 12 Factor App準拠の環境変数による設定管理
- `.env`ファイルによるローカル設定のオーバーライド

### 構造化ログ
- 検索クエリ・実行時間・結果件数をログに記録
- 運用時のパフォーマンス分析・障害調査に活用可能

### 一貫したエラーハンドリング
- 統一されたエラーレスポンス形式（error code + message + details）
- アプリケーション例外クラスによるエラーの型安全な管理

### スケーラビリティロードマップ
| 規模 | 対策 |
|------|------|
| ~1,000件（現在） | 現設計で十分 |
| ~10万件 | HNSWパラメータ調整、Redisキャッシュ導入 |
| 10万件超 | 専用ベクトルDB（Qdrant等）への移行、検索サービス分離 |

---

## 5. その他の観点

### 2モード検索の実装
- セマンティック検索・キーワード検索の2モード対応
- 要件の「意味的な類似度」検索に加え、キーワード検索も提供することで実用性を向上
- UIで検索モードを切り替え可能にし、ユースケースに応じた使い分けを実現

### 記事更新時のEmbedding再生成
- title/content変更時にEmbeddingベクトルを自動再生成
- セマンティック検索の結果が常に最新の記事内容と一致することを保証
- author/categoryのみの変更では不要な再計算を回避

### API設計の一貫性
- RESTful設計に準拠したエンドポイント構成
- ページネーション・カテゴリフィルタの共通パラメータ
- OpenAPI 3.0準拠のAPI仕様自動生成
